<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="August 2023, UC Berkeley">

<title>tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-179469d940bc53b7d989303f68e0e62a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../assets/styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../units/intro.html">Modules</a></li><li class="breadcrumb-item"><a href="../units/tidyverse.html">Tidyverse</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Voleon R Bootcamp</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/paciorek/r-voleon-2025" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home / Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../prep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preparation</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Modules</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Introduction (Module “0”)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Structures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/calculation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Calculation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programming</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/tidyverse.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Tidyverse</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Plotting (ggplot)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/analysis" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analysis/Packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Additional Topics</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#data-frame-manipulation-using-base-r-functions" id="toc-data-frame-manipulation-using-base-r-functions" class="nav-link" data-scroll-target="#data-frame-manipulation-using-base-r-functions">Data frame manipulation using base R functions</a></li>
  <li><a href="#data-frame-manipulation-using-dplyr" id="toc-data-frame-manipulation-using-dplyr" class="nav-link" data-scroll-target="#data-frame-manipulation-using-dplyr">Data frame manipulation using <code>dplyr</code></a></li>
  <li><a href="#dplyrselect" id="toc-dplyrselect" class="nav-link" data-scroll-target="#dplyrselect"><code>dplyr::select</code></a></li>
  <li><a href="#piping-with-dplyr" id="toc-piping-with-dplyr" class="nav-link" data-scroll-target="#piping-with-dplyr">piping with <code>dplyr</code></a>
  <ul class="collapse">
  <li><a href="#enter-the-pipe" id="toc-enter-the-pipe" class="nav-link" data-scroll-target="#enter-the-pipe">Enter the pipe…</a></li>
  </ul></li>
  <li><a href="#select-pipe" id="toc-select-pipe" class="nav-link" data-scroll-target="#select-pipe"><code>select</code> &amp; Pipe (<code>%&gt;%</code>)</a></li>
  <li><a href="#selecting-columns-quick-quiz" id="toc-selecting-columns-quick-quiz" class="nav-link" data-scroll-target="#selecting-columns-quick-quiz">Selecting columns: quick quiz</a></li>
  <li><a href="#dplyrfilter" id="toc-dplyrfilter" class="nav-link" data-scroll-target="#dplyrfilter"><code>dplyr::filter</code></a></li>
  <li><a href="#dplyr-calculations-across-groups" id="toc-dplyr-calculations-across-groups" class="nav-link" data-scroll-target="#dplyr-calculations-across-groups"><code>dplyr</code> calculations across groups</a></li>
  <li><a href="#dplyr-split-apply-combine" id="toc-dplyr-split-apply-combine" class="nav-link" data-scroll-target="#dplyr-split-apply-combine"><code>dplyr</code> split-apply-combine</a></li>
  <li><a href="#dplyrgroup_by" id="toc-dplyrgroup_by" class="nav-link" data-scroll-target="#dplyrgroup_by"><code>dplyr::group_by</code></a></li>
  <li><a href="#dplyrsummarize" id="toc-dplyrsummarize" class="nav-link" data-scroll-target="#dplyrsummarize"><code>dplyr::summarize</code></a></li>
  <li><a href="#dplyrmutate" id="toc-dplyrmutate" class="nav-link" data-scroll-target="#dplyrmutate"><code>dplyr::mutate</code></a></li>
  <li><a href="#mutate-vs.-summarize" id="toc-mutate-vs.-summarize" class="nav-link" data-scroll-target="#mutate-vs.-summarize"><code>mutate</code> vs.&nbsp;<code>summarize</code></a></li>
  <li><a href="#mutate-vs.-summarize-quick-quiz" id="toc-mutate-vs.-summarize-quick-quiz" class="nav-link" data-scroll-target="#mutate-vs.-summarize-quick-quiz"><code>mutate</code> vs.&nbsp;<code>summarize</code>: quick quiz</a></li>
  <li><a href="#dplyrarrange" id="toc-dplyrarrange" class="nav-link" data-scroll-target="#dplyrarrange"><code>dplyr::arrange</code></a></li>
  <li><a href="#dplyr-take-aways" id="toc-dplyr-take-aways" class="nav-link" data-scroll-target="#dplyr-take-aways"><code>dplyr</code> take-aways</a></li>
  <li><a href="#dplyr-and-non-standard-evaluation" id="toc-dplyr-and-non-standard-evaluation" class="nav-link" data-scroll-target="#dplyr-and-non-standard-evaluation">dplyr and “non-standard evaluation”</a></li>
  <li><a href="#tidying-data" id="toc-tidying-data" class="nav-link" data-scroll-target="#tidying-data">Tidying data</a></li>
  <li><a href="#wide-vs.-long-formats" id="toc-wide-vs.-long-formats" class="nav-link" data-scroll-target="#wide-vs.-long-formats">Wide vs.&nbsp;long formats</a></li>
  <li><a href="#tidying-the-gapminder-data" id="toc-tidying-the-gapminder-data" class="nav-link" data-scroll-target="#tidying-the-gapminder-data">Tidying the Gapminder data</a></li>
  <li><a href="#tidyr" id="toc-tidyr" class="nav-link" data-scroll-target="#tidyr"><code>tidyr</code></a></li>
  <li><a href="#tidyrpivot_longer" id="toc-tidyrpivot_longer" class="nav-link" data-scroll-target="#tidyrpivot_longer"><code>tidyr::pivot_longer</code></a></li>
  <li><a href="#tidyrselect" id="toc-tidyrselect" class="nav-link" data-scroll-target="#tidyrselect"><code>tidyr::select</code></a></li>
  <li><a href="#tidyrseparate" id="toc-tidyrseparate" class="nav-link" data-scroll-target="#tidyrseparate"><code>tidyr::separate</code></a></li>
  <li><a href="#tidyrpivot_wider" id="toc-tidyrpivot_wider" class="nav-link" data-scroll-target="#tidyrpivot_wider"><code>tidyr::pivot_wider</code></a></li>
  <li><a href="#extra-resources-optional" id="toc-extra-resources-optional" class="nav-link" data-scroll-target="#extra-resources-optional">Extra Resources (optional)</a></li>
  <li><a href="#breakout" id="toc-breakout" class="nav-link" data-scroll-target="#breakout">Breakout</a>
  <ul class="collapse">
  <li><a href="#dplyr" id="toc-dplyr" class="nav-link" data-scroll-target="#dplyr"><code>dplyr</code></a></li>
  <li><a href="#tidyr-1" id="toc-tidyr-1" class="nav-link" data-scroll-target="#tidyr-1"><code>tidyr</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../units/intro.html">Modules</a></li><li class="breadcrumb-item"><a href="../units/tidyverse.html">Tidyverse</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">R Bootcamp, Module 6: Data manipulation with the <code>tidyverse</code></h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Chris Paciorek</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="overview" class="level1">
<h1>Overview</h1>
<blockquote class="blockquote">
<p>It is often said that 80% of data analysis is spent on the process of cleaning and preparing the data (Dasu and Johnson, 2003).</p>
</blockquote>
<p>Thus before you can even get to doing any sort of sophisticated analysis or plotting, you’ll generally first need to:</p>
<ol type="1">
<li><strong><em>Manipulating</em></strong> data frames, e.g., filtering, summarizing, and conducting calculations across groups.</li>
<li><strong><em>Tidying</em></strong> data into the appropriate format</li>
</ol>
<p>The <a href="https://www.tidyverse.org/"><code>tidyverse</code></a> is a suite of packages designed specifically to help with both these steps; some of which we will be introducing in this module. These are by no means the only packages out there for data wrangling but they are increasingly popular for their readable, straightforward syntax and sensible default behaviors.</p>
</section>
<section id="data-frame-manipulation-using-base-r-functions" class="level1">
<h1>Data frame manipulation using base R functions</h1>
<p>So far, you’ve seen the basics of manipulating data frames, e.g.&nbsp;subsetting, merging, and basic calculations. For instance, we can use base R functions to calculate summary statistics across groups of observations, e.g., the mean GDP per capita within each region:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Africa"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2193.755</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Americas"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7136.11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Asia"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7902.15</code></pre>
</div>
</div>
<p>But this isn’t ideal because it involves a fair bit of repetition. Repeating yourself will cost you time, both now and later, and potentially introduce hard-to-find bugs.</p>
</section>
<section id="data-frame-manipulation-using-dplyr" class="level1">
<h1>Data frame manipulation using <code>dplyr</code></h1>
<p>Luckily, the <a href="https://cran.r-project.org/web/packages/dplyr/dplyr.pdf"><code>dplyr</code></a> package provides a number of very useful functions for manipulating data frames. These functions will save you time and hassle by reducing repetition, and will help to make your code more human-readable (trust me: your future self and others might thank you!)</p>
<p>Here we’re going to cover 6 of the most commonly used functions as well as using pipes (<code>%&gt;%</code>) to combine them.</p>
<ol type="1">
<li><code>select()</code></li>
<li><code>filter()</code></li>
<li><code>group_by()</code></li>
<li><code>summarize()</code></li>
<li><code>mutate()</code></li>
<li><code>arrange()</code></li>
</ol>
<p>Let’s load the package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dplyrselect" class="level1">
<h1><code>dplyr::select</code></h1>
<p>Imagine that we just received the gapminder dataset, but are only interested in a few variables in it. The <code>select()</code> function can help us to keep only the columns corresponding to variables we select.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>year_country_gdp_dplyr <span class="ot">&lt;-</span> <span class="fu">select</span>(gapminder, year, country, gdpPercap)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(year_country_gdp_dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
   year country     gdpPercap
  &lt;int&gt; &lt;fct&gt;           &lt;dbl&gt;
1  1952 Afghanistan      779.
2  1957 Afghanistan      821.
3  1962 Afghanistan      853.
4  1967 Afghanistan      836.
5  1972 Afghanistan      740.
6  1977 Afghanistan      786.</code></pre>
</div>
</div>
<p><img src="img/dplyr-fig1.png" class="img-fluid"></p>
<p>We see the new dataframe only contains the year, country and gdpPercap. This is equivalent to the base R subsetting function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>year_country_gdp_base <span class="ot">&lt;-</span> gapminder[,<span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"country"</span>, <span class="st">"gdpPercap"</span>)]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(year_country_gdp_base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
   year country     gdpPercap
  &lt;int&gt; &lt;fct&gt;           &lt;dbl&gt;
1  1952 Afghanistan      779.
2  1957 Afghanistan      821.
3  1962 Afghanistan      853.
4  1967 Afghanistan      836.
5  1972 Afghanistan      740.
6  1977 Afghanistan      786.</code></pre>
</div>
</div>
<p>We can even check that these two data frames are the same:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(year_country_gdp_dplyr, year_country_gdp_base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>But, as we will see, <code>dplyr</code> makes for much more readable, efficient code because of its <em>pipe</em> operator.</p>
</section>
<section id="piping-with-dplyr" class="level1">
<h1>piping with <code>dplyr</code></h1>
<p><img src="img/magrittr_hex.png" class="img-fluid"></p>
<p>Above, we used what’s called “normal” grammar, but the strengths of <code>dplyr</code> lie in combining several functions using <em>pipes</em>.</p>
<p>In typical base R code, a simple operation might be written like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NOT run</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>cupcakes <span class="ot">&lt;-</span> <span class="fu">bake</span>(<span class="fu">pour</span>(<span class="fu">mix</span>(ingredients)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A computer has no trouble understanding this and your cupcakes will be made just fine but a person has to read right to left to understand the order of operations - the opposite of how most western languages are read - making it harder to understand what is being done!</p>
<p>To be more readable without pipes, we might break up this code into intermediate objects…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NOT run</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>batter <span class="ot">&lt;-</span> <span class="fu">mix</span>(ingredients)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>muffin_tin <span class="ot">&lt;-</span> <span class="fu">pour</span>(batter)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>cupcakes <span class="ot">&lt;-</span> <span class="fu">bake</span>(muffin_tin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>but this can clutter our environment with a lot of variables that aren’t very useful to us, and often are named very similar things (e.g.&nbsp;step, step1, step2…) which can lead to confusion and those hard-to-track-down bugs.</p>
<section id="enter-the-pipe" class="level3">
<h3 class="anchored" data-anchor-id="enter-the-pipe">Enter the pipe…</h3>
<p>The <em>pipe</em> makes it easier to read code because it lays out the operations left to right so each line can be read like a line of a recipe for the perfect data frame!</p>
<p>Pipes take the input on the left side of the <code>%&gt;%</code> symbol and pass it in as the first argument to the function on the right side.</p>
<p>With pipes, our cupcake example might be written like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## NOT run</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>cupcakes <span class="ot">&lt;-</span> ingredients <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pour</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Tip</strong>: As of R 4.1.0, you can use <code>|&gt;</code> from base R without needing to load dplyr.</p>
<p><strong>Pro Tip</strong>: In RStudio the hotkey for the pipe is Ctrl + Shift + M.</p>
</section>
</section>
<section id="select-pipe" class="level1">
<h1><code>select</code> &amp; Pipe (<code>%&gt;%</code>)</h1>
<p>Since the pipe grammar is unlike anything we’ve seen in R before, let’s repeat what we did above with the gapminder dataset using pipes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>year_country_gdp <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, country, gdpPercap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First, we summon the gapminder data frame and pass it on to the next step using the pipe symbol <code>%&gt;%</code>. The second step is the <code>select()</code> function. In this case we don’t specify which data object we use in the call to <code>select()</code> since we’ve piped it in.</p>
<p><strong>Fun Fact</strong>: There is a good chance you have encountered pipes before in the shell. In R, a pipe symbol is <code>%&gt;%</code> while in the shell it is <code>|.</code> But the concept is the same!</p>
</section>
<section id="selecting-columns-quick-quiz" class="level1">
<h1>Selecting columns: quick quiz</h1>
<p><strong><a href="https://www.polleverywhere.com/multiple_choice_polls/1BDSh7IPqBR6gRLTDt0Pp">P</a>OLL 6A</strong>: Which of these will produce an error? (Assume ‘continent’ is a column in the data frame but not a stand-alone variable.)</p>
<p>(respond at <a href="https://pollev.com/chrispaciorek428">https://pollev.com/chrispaciorek428</a>)</p>
<ol type="1">
<li>gapminder[ , ‘continent’]</li>
<li>gapminder[ , continent]</li>
<li>gapminder %&gt;% select(continent)</li>
<li>gapminder %&gt;% select(gapminder, continent)</li>
<li>gapminder %&gt;% select(‘continent’)</li>
<li>gapminder$continent</li>
<li>gapminder$“continent”</li>
<li>gapminder[[continent]]</li>
<li>gapminder[[‘continent’]]</li>
</ol>
<p>We’ll talk more about when you need quotes and when not a bit later.</p>
</section>
<section id="dplyrfilter" class="level1">
<h1><code>dplyr::filter</code></h1>
<p>Now let’s say we’re only interested in African countries. We can combine <code>select</code> and <code>filter</code> to select only the observations where <code>continent</code> is <code>Africa</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>year_country_gdp_africa <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"Africa"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(year,country,gdpPercap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As with last time, first we pass the gapminder data frame to the <code>filter()</code> function, then we pass the filtered version of the gapminder data frame to the <code>select()</code> function.</p>
<p>To clarify, both the <code>select</code> and <code>filter</code> functions subsets the data frame. The difference is that <code>select</code> extracts certain <em>columns</em>, while <code>filter</code> extracts certain <em>rows</em>.</p>
<p><strong>Note:</strong> The order of operations is very important in this case. If we used ‘select’ first, filter would not be able to find the variable <code>continent</code> since we would have removed it in the previous step.</p>
</section>
<section id="dplyr-calculations-across-groups" class="level1">
<h1><code>dplyr</code> calculations across groups</h1>
<p>A common task you’ll encounter when working with data is running calculations on different groups within the data. For instance, what if we wanted to calculate the mean GDP per capita for each continent?</p>
<p>In base R, you would have to run the <code>mean()</code> function for each subset of data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Africa"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2193.755</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Americas"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7136.11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Asia"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7902.15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Europe"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14469.48</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Oceania"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18621.61</code></pre>
</div>
</div>
<p>That’s a lot of repetition! To make matters worse, what if we wanted to add these values to our original data frame as a new column? We would have to write something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>gapminder<span class="sc">$</span>mean_continent_gdp <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>gapminder<span class="sc">$</span>mean_continent_gdp[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Africa"</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Africa"</span>])</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>gapminder<span class="sc">$</span>mean_continent_gdp[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Americas"</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Americas"</span>])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>gapminder<span class="sc">$</span>mean_continent_gdp[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Asia"</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Asia"</span>])</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>gapminder<span class="sc">$</span>mean_continent_gdp[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Europe"</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Europe"</span>])</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>gapminder<span class="sc">$</span>mean_continent_gdp[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Oceania"</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Oceania"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can see how this can get pretty tedious, especially if we want to calculate more complicated or refined statistics. We could use loops or apply functions, but these can be difficult, slow, or error-prone.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Want to remove the column we just made? -- there are two easy ways!</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>gapminder <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>mean_continent_gdp) <span class="co"># drop a column with - </span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># OR</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>gapminder<span class="sc">$</span>mean_continent_gdp <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dplyr-split-apply-combine" class="level1">
<h1><code>dplyr</code> split-apply-combine</h1>
<p>The abstract problem we’re encountering here is know as “split-apply-combine”:</p>
<p><img src="img/splitapply.png" class="img-fluid"></p>
<p>We want to <em>split</em> our data into groups (in this case continents), <em>apply</em> some calculations on each group, then <em>combine</em> the results together afterwards.</p>
<p>Module 4 gave some ways to do split-apply-combine type operations using the <code>lapply</code> family of functions, but <code>dplyr</code> offers a cleaner, more straight-forward solution to this problem specifically for data frames.</p>
</section>
<section id="dplyrgroup_by" class="level1">
<h1><code>dplyr::group_by</code></h1>
<p>We’ve already seen how <code>filter()</code> can help us select observations that meet certain criteria (in the above: <code>continent == "Europe"</code>). More helpful, however, is the <code>group_by()</code> function, which will essentially use every unique criteria that we could have used in <code>filter()</code>.</p>
<p>A <code>grouped_df</code> can be thought of as a <code>list</code> where each item in the <code>list</code> is a <code>data.frame</code> which contains only the rows that correspond to a particular value of one or more grouping variables (<code>continent</code> in our example).</p>
<p><img src="img/dplyr-fig2.png" class="img-fluid"></p>
</section>
<section id="dplyrsummarize" class="level1">
<h1><code>dplyr::summarize</code></h1>
<p><code>group_by()</code> on its own is not particularly interesting. It’s much more exciting used in conjunction with the <code>summarize()</code> function. This will allow use to create new variable(s) by applying transformations to variables in each of the continent-specific data frames.</p>
<p>In other words, using the <code>group_by()</code> function, we split our original data frame into multiple pieces, which we then apply summary functions to (e.g., <code>mean()</code> or <code>sd()</code>) within <code>summarize()</code>. The output is a new data frame reduced in size, with one row per group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>gdp_bycontinents <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gdp_bycontinents)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  continent mean_gdpPercap
  &lt;fct&gt;              &lt;dbl&gt;
1 Africa             2194.
2 Americas           7136.
3 Asia               7902.
4 Europe            14469.
5 Oceania           18622.</code></pre>
</div>
</div>
<p><img src="img/dplyr-fig3.png" class="img-fluid"></p>
<p>That allowed us to calculate the mean gdpPercap for each continent. But it gets even better – the function <code>group_by()</code> allows us to group by multiple variables. Let’s group by <code>year</code> and <code>continent</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>gdp_bycontinents_byyear <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gdp_bycontinents_byyear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
# Groups:   continent [1]
  continent  year mean_gdpPercap
  &lt;fct&gt;     &lt;int&gt;          &lt;dbl&gt;
1 Africa     1952          1253.
2 Africa     1957          1385.
3 Africa     1962          1598.
4 Africa     1967          2050.
5 Africa     1972          2340.
6 Africa     1977          2586.</code></pre>
</div>
</div>
<p>That is already quite powerful, but it gets even better! You’re not limited to defining one new variable in <code>summarize()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>gdp_pop_bycontinents_byyear <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap),</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdpPercap =</span> <span class="fu">sd</span>(gdpPercap),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_pop =</span> <span class="fu">mean</span>(pop),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_pop =</span> <span class="fu">sd</span>(pop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gdp_pop_bycontinents_byyear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
# Groups:   continent [1]
  continent  year mean_gdpPercap sd_gdpPercap mean_pop    sd_pop
  &lt;fct&gt;     &lt;int&gt;          &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Africa     1952          1253.         983. 4570010.  6317450.
2 Africa     1957          1385.        1135. 5093033.  7076042.
3 Africa     1962          1598.        1462. 5702247.  7957545.
4 Africa     1967          2050.        2848. 6447875.  8985505.
5 Africa     1972          2340.        3287. 7305376. 10130833.
6 Africa     1977          2586.        4142. 8328097. 11585184.</code></pre>
</div>
</div>
</section>
<section id="dplyrmutate" class="level1">
<h1><code>dplyr::mutate</code></h1>
<p>What if we wanted to add these values to our original data frame instead of creating a new object? For this, we can use the <code>mutate()</code> function, which is similar to <code>summarize()</code> except it creates new variables in the same data frame that you pass into it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>gap_with_extra_vars <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap),</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdpPercap =</span> <span class="fu">sd</span>(gdpPercap),</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_pop =</span> <span class="fu">mean</span>(pop),</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_pop =</span> <span class="fu">sd</span>(pop))</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_with_extra_vars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
# Groups:   continent, year [6]
  country   continent  year lifeExp    pop gdpPercap mean_gdpPercap sd_gdpPercap
  &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;  &lt;int&gt;     &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;
1 Afghanis… Asia       1952    28.8 8.43e6      779.          5195.       18635.
2 Afghanis… Asia       1957    30.3 9.24e6      821.          5788.       19507.
3 Afghanis… Asia       1962    32.0 1.03e7      853.          5729.       16416.
4 Afghanis… Asia       1967    34.0 1.15e7      836.          5971.       14063.
5 Afghanis… Asia       1972    36.1 1.31e7      740.          8187.       19088.
6 Afghanis… Asia       1977    38.4 1.49e7      786.          7791.       11816.
# ℹ 2 more variables: mean_pop &lt;dbl&gt;, sd_pop &lt;dbl&gt;</code></pre>
</div>
</div>
<p>We can use also use <code>mutate()</code> to create new variables prior to (or even after) summarizing information. Note that <code>mutate()</code> does not need to operate on grouped data and it can do element-wise transformations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>gdp_pop_bycontinents_byyear <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">gdp_billion =</span> gdpPercap<span class="sc">*</span>pop<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap),</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdpPercap =</span> <span class="fu">sd</span>(gdpPercap),</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_pop =</span> <span class="fu">mean</span>(pop),</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_pop =</span> <span class="fu">sd</span>(pop),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_gdp_billion =</span> <span class="fu">mean</span>(gdp_billion),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdp_billion =</span> <span class="fu">sd</span>(gdp_billion))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gdp_pop_bycontinents_byyear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
# Groups:   continent [1]
  continent  year mean_gdpPercap sd_gdpPercap mean_pop   sd_pop mean_gdp_billion
  &lt;fct&gt;     &lt;int&gt;          &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;            &lt;dbl&gt;
1 Africa     1952          1253.         983. 4570010.   6.32e6             5.99
2 Africa     1957          1385.        1135. 5093033.   7.08e6             7.36
3 Africa     1962          1598.        1462. 5702247.   7.96e6             8.78
4 Africa     1967          2050.        2848. 6447875.   8.99e6            11.4 
5 Africa     1972          2340.        3287. 7305376.   1.01e7            15.1 
6 Africa     1977          2586.        4142. 8328097.   1.16e7            18.7 
# ℹ 1 more variable: sd_gdp_billion &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="mutate-vs.-summarize" class="level1">
<h1><code>mutate</code> vs.&nbsp;<code>summarize</code></h1>
<p>It can be confusing to decide whether to use <code>mutate</code> or <code>summarize</code>. The key distinction is whether you want the output to have one row for each group or one row for each row in the original data frame:</p>
<ul>
<li><code>mutate</code>: creates new columns with as many rows as the original data frame</li>
<li><code>summarize</code>: creates a data frame with as many rows as groups</li>
</ul>
<p>Note that if you use an aggregation function such as <code>mean()</code> within <code>mutate()</code> without using <code>groupby()</code>, you’ll simply do the summary over all the rows of the input data frame.</p>
<p>And if you use an aggregation function such as <code>mean()</code> within <code>summarize()</code> without using <code>groupby()</code>, you’ll simply create an output data frame with one row (i.e., the whole input data frame is a single group).</p>
</section>
<section id="mutate-vs.-summarize-quick-quiz" class="level1">
<h1><code>mutate</code> vs.&nbsp;<code>summarize</code>: quick quiz</h1>
<p><strong><a href="https://www.polleverywhere.com/multiple_choice_polls/RPDOSwm5VqRh2nY0VWxAN">P</a>OLL 6B</strong>: Which of these has the same number of rows as the original gapminder dataframe?</p>
<p>(respond at <a href="https://pollev.com/chrispaciorek428">https://pollev.com/chrispaciorek428</a>)</p>
<ol type="1">
<li>gapminder %&gt;% group_by(continent) %&gt;% mutate(mean_gdp = mean(gdpPercap))</li>
<li>gapminder %&gt;% group_by(continent) %&gt;% summarize(mean_gdp = mean(gdpPercap))</li>
<li>gapminder %&gt;% group_by(continent) %&gt;% summarize(mean_gdp = mean(gdpPercap)) %&gt;% mutate(mean_gdpBillion = mean_gdp / 1e9)</li>
</ol>
</section>
<section id="dplyrarrange" class="level1">
<h1><code>dplyr::arrange</code></h1>
<p>As a last step, let’s say we want to sort the rows in our data frame according to values in a certain column. We can use the <code>arrange()</code> function to do this. For instance, let’s organize our rows by <code>year</code> (recent first), and then by <code>continent</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>gap_with_extra_vars <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdpPercap =</span> <span class="fu">sd</span>(gdpPercap),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_pop =</span> <span class="fu">mean</span>(pop),</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_pop =</span> <span class="fu">sd</span>(pop)) <span class="sc">%&gt;%</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(year), continent) <span class="co"># `desc()` = descending order</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_with_extra_vars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
# Groups:   continent, year [1]
  country   continent  year lifeExp    pop gdpPercap mean_gdpPercap sd_gdpPercap
  &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;  &lt;int&gt;     &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;
1 Algeria   Africa     2007    72.3 3.33e7     6223.          3089.        3618.
2 Angola    Africa     2007    42.7 1.24e7     4797.          3089.        3618.
3 Benin     Africa     2007    56.7 8.08e6     1441.          3089.        3618.
4 Botswana  Africa     2007    50.7 1.64e6    12570.          3089.        3618.
5 Burkina … Africa     2007    52.3 1.43e7     1217.          3089.        3618.
6 Burundi   Africa     2007    49.6 8.39e6      430.          3089.        3618.
# ℹ 2 more variables: mean_pop &lt;dbl&gt;, sd_pop &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="dplyr-take-aways" class="level1">
<h1><code>dplyr</code> take-aways</h1>
<ul>
<li>Human readable: the function names describe the action being done</li>
<li>Piping: chain functions in a step-by-step way, rather than nesting</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># without pipes:</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>gap_with_extra_vars <span class="ot">&lt;-</span> <span class="fu">arrange</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(gapminder, continent, year),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">desc</span>(year), continent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Facilitates split-apply-combine manipulations for data frames</li>
</ul>
</section>
<section id="dplyr-and-non-standard-evaluation" class="level1">
<h1>dplyr and “non-standard evaluation”</h1>
<p>You may run across the term “non-standard evaluation”. The use of data frame variables without quotes around them is an example of this.</p>
<p>Why is this strange?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">select</span>(continent, year) <span class="sc">%&gt;%</span> <span class="fu">tail</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compare it to:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>gapminder[ , <span class="fu">c</span>(<span class="st">'continent'</span>, <span class="st">'year'</span>)]</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>gapminder[ , <span class="st">'continent'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Because <code>continent</code> and <code>year</code> are not variables our current environment! dplyr does some fancy stuff behind the scenes to save us from typing the quotes.</p>
<p>This is fine if you have a data analysis workflow but if you want to write a function that, for example, selects an arbitrary set of columns, you’ll run into trouble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="do">## here's a helper function that computes the mean of a variable, stratifying by a grouping variable</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>grouped_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(data, group_var, summary_var) {</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(group_var) <span class="sc">%&gt;%</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(summary_var))</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">grouped_mean</span>(continent, lifeExp)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> <span class="fu">grouped_mean</span>(<span class="st">'continent'</span>, <span class="st">'lifeExp'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>See the <code>rlang</code>, <code>tidyeval</code> and <code>wrapr</code> packages for how one can deal with this problem in this context of using functions.</p>
</section>
<section id="tidying-data" class="level1">
<h1>Tidying data</h1>
<p>Even before we conduct analysis or calculations, we need to put our data into the correct format. The goal here is to rearrange a messy dataset into one that is <strong>tidy</strong>.</p>
<p>The two most important properties of tidy data are:</p>
<ol type="1">
<li>Each column is a variable.</li>
<li>Each row is an observation.</li>
</ol>
<p>Tidy data is easier to work with, because you have a consistent way of referring to variables (as column names) and observations (as row indices). It then becomes easy to manipulate, visualize, and model.</p>
<p>For more on the concept of <em>tidy</em> data, you can read <a href="http://vita.had.co.nz/papers/tidy-data.html">Hadley Wickham’s paper</a>.</p>
</section>
<section id="wide-vs.-long-formats" class="level1">
<h1>Wide vs.&nbsp;long formats</h1>
<blockquote class="blockquote">
<p>“Tidy datasets are all alike but every messy dataset is messy in its own way.” – Hadley Wickham</p>
</blockquote>
<p>Tabular datasets can be arranged in many ways. For instance, consider the data below. Each data set displays information on heart rate observed in individuals across 3 different time periods. But the data are organized differently in each table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>wide <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Wilbur"</span>, <span class="st">"Petunia"</span>, <span class="st">"Gregory"</span>),</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">time1 =</span> <span class="fu">c</span>(<span class="dv">67</span>, <span class="dv">80</span>, <span class="dv">64</span>),</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">time2 =</span> <span class="fu">c</span>(<span class="dv">56</span>, <span class="dv">90</span>, <span class="dv">50</span>),</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">time3 =</span> <span class="fu">c</span>(<span class="dv">70</span>, <span class="dv">67</span>, <span class="dv">101</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name time1 time2 time3
1  Wilbur    67    56    70
2 Petunia    80    90    67
3 Gregory    64    50   101</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>long <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Wilbur"</span>, <span class="st">"Petunia"</span>, <span class="st">"Gregory"</span>, <span class="st">"Wilbur"</span>, <span class="st">"Petunia"</span>, <span class="st">"Gregory"</span>, <span class="st">"Wilbur"</span>, <span class="st">"Petunia"</span>, <span class="st">"Gregory"</span>),</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">heartrate =</span> <span class="fu">c</span>(<span class="dv">67</span>, <span class="dv">80</span>, <span class="dv">64</span>, <span class="dv">56</span>, <span class="dv">90</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">67</span>, <span class="dv">10</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name time heartrate
1  Wilbur    1        67
2 Petunia    1        80
3 Gregory    1        64
4  Wilbur    2        56
5 Petunia    2        90
6 Gregory    2        50
7  Wilbur    3        70
8 Petunia    3        67
9 Gregory    3        10</code></pre>
</div>
</div>
<p><strong><a href="https://www.polleverywhere.com/multiple_choice_polls/NIjOztXluscRrLFsE6MxH">P</a>OLL 6C</strong>: Which of the ‘wide’ and ‘long’ objects do you prefer in terms of how the heartrate ‘data’ are formatted?</p>
<p>(respond at <a href="https://pollev.com/chrispaciorek428">https://pollev.com/chrispaciorek428</a>)</p>
<ol type="1">
<li>wide</li>
<li>long</li>
<li>I’d format it some other way</li>
</ol>
<p><strong>Question</strong>: Which one of these do you think is the <em>tidy</em> format?</p>
<p><strong>Answer</strong>: The first data frame (the “wide” one) would not be considered <em>tidy</em> because values (i.e., heartrate) are spread across multiple columns.</p>
<p>We often refer to these different structures as “long” vs.&nbsp;“wide” formats. In the “long” format, you usually have 1 column for the observed variable and the other columns are ID variables.</p>
<p>For the “wide” format each row is often a site/subject/patient and you have multiple observation variables containing the same type of data. These can be either repeated observations over time, or observation of multiple variables (or a mix of both). In the above case, we had the same kind of data (heart rate) entered across 3 different columns, corresponding to three different time periods.</p>
<p><img src="img/tidyr-fig1.png" class="img-fluid"></p>
<p>You may find data input may be simpler and some programs/functions may prefer the “wide” format. However, many of R’s functions have been designed assuming you have “long” format data.</p>
</section>
<section id="tidying-the-gapminder-data" class="level1">
<h1>Tidying the Gapminder data</h1>
<p>Lets look at the structure of our original gapminder data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gapminder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  country     continent  year lifeExp      pop gdpPercap
  &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
1 Afghanistan Asia       1952    28.8  8425333      779.
2 Afghanistan Asia       1957    30.3  9240934      821.
3 Afghanistan Asia       1962    32.0 10267083      853.
4 Afghanistan Asia       1967    34.0 11537966      836.
5 Afghanistan Asia       1972    36.1 13079460      740.
6 Afghanistan Asia       1977    38.4 14880372      786.</code></pre>
</div>
</div>
<p><strong>Question</strong>: Is this data frame <strong>wide</strong> or <strong>long</strong>?</p>
<p><strong>Answer</strong>: This data frame is somewhere in between the purely ‘long’ and ‘wide’ formats. We have 3 “ID variables” (<code>continent</code>, <code>country</code>, <code>year</code>) and 3 “Observation variables” (<code>pop</code>, <code>lifeExp</code>, <code>gdpPercap</code>).</p>
<p>Despite not having ALL observations in 1 column, this intermediate format makes sense given that all 3 observation variables have different units. As we have seen, many of the functions in R are often vector based, and you usually do not want to do mathematical operations on values with different units.</p>
<p>On the other hand, there are some instances in which a purely long or wide format is ideal (e.g.&nbsp;plotting). Likewise, sometimes you’ll get data on your desk that is poorly organized, and you’ll need to <strong>reshape</strong> it.</p>
</section>
<section id="tidyr" class="level1">
<h1><code>tidyr</code></h1>
<p>Thankfully, the <code>tidyr</code> package will help you efficiently transform your data regardless of original format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install the "tidyr" package (only necessary one time)</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("tidyr") # Not Run</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the "tidyr" package (necessary every new R session)</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tidyrpivot_longer" class="level1">
<h1><code>tidyr::pivot_longer</code></h1>
<p>Until now, we’ve been using the nicely formatted original gapminder data set. This data set is not quite wide and not quite long – it’s something in the middle, but “real” data (i.e., our own research data) will never be so well organized. Here let’s start with the wide format version of the gapminder data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>gap_wide <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"../data/gapminder_wide.csv"</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  continent      country gdpPercap_1952 gdpPercap_1957 gdpPercap_1962
1    Africa      Algeria      2449.0082      3013.9760      2550.8169
2    Africa       Angola      3520.6103      3827.9405      4269.2767
3    Africa        Benin      1062.7522       959.6011       949.4991
4    Africa     Botswana       851.2411       918.2325       983.6540
5    Africa Burkina Faso       543.2552       617.1835       722.5120
6    Africa      Burundi       339.2965       379.5646       355.2032
  gdpPercap_1967 gdpPercap_1972 gdpPercap_1977 gdpPercap_1982 gdpPercap_1987
1      3246.9918      4182.6638      4910.4168      5745.1602      5681.3585
2      5522.7764      5473.2880      3008.6474      2756.9537      2430.2083
3      1035.8314      1085.7969      1029.1613      1277.8976      1225.8560
4      1214.7093      2263.6111      3214.8578      4551.1421      6205.8839
5       794.8266       854.7360       743.3870       807.1986       912.0631
6       412.9775       464.0995       556.1033       559.6032       621.8188
  gdpPercap_1992 gdpPercap_1997 gdpPercap_2002 gdpPercap_2007 lifeExp_1952
1      5023.2166      4797.2951      5288.0404      6223.3675       43.077
2      2627.8457      2277.1409      2773.2873      4797.2313       30.015
3      1191.2077      1232.9753      1372.8779      1441.2849       38.223
4      7954.1116      8647.1423     11003.6051     12569.8518       47.622
5       931.7528       946.2950      1037.6452      1217.0330       31.975
6       631.6999       463.1151       446.4035       430.0707       39.031
  lifeExp_1957 lifeExp_1962 lifeExp_1967 lifeExp_1972 lifeExp_1977 lifeExp_1982
1       45.685       48.303       51.407       54.518       58.014       61.368
2       31.999       34.000       35.985       37.928       39.483       39.942
3       40.358       42.618       44.885       47.014       49.190       50.904
4       49.618       51.520       53.298       56.024       59.319       61.484
5       34.906       37.814       40.697       43.591       46.137       48.122
6       40.533       42.045       43.548       44.057       45.910       47.471
  lifeExp_1987 lifeExp_1992 lifeExp_1997 lifeExp_2002 lifeExp_2007 pop_1952
1       65.799       67.744       69.152       70.994       72.301  9279525
2       39.906       40.647       40.963       41.003       42.731  4232095
3       52.337       53.919       54.777       54.406       56.728  1738315
4       63.622       62.745       52.556       46.634       50.728   442308
5       49.557       50.260       50.324       50.650       52.295  4469979
6       48.211       44.736       45.326       47.360       49.580  2445618
  pop_1957 pop_1962 pop_1967 pop_1972 pop_1977 pop_1982 pop_1987 pop_1992
1 10270856 11000948 12760499 14760787 17152804 20033753 23254956 26298373
2  4561361  4826015  5247469  5894858  6162675  7016384  7874230  8735988
3  1925173  2151895  2427334  2761407  3168267  3641603  4243788  4981671
4   474639   512764   553541   619351   781472   970347  1151184  1342614
5  4713416  4919632  5127935  5433886  5889574  6634596  7586551  8878303
6  2667518  2961915  3330989  3529983  3834415  4580410  5126023  5809236
  pop_1997 pop_2002 pop_2007
1 29072015 31287142 33333216
2  9875024 10866106 12420476
3  6066080  7026113  8078314
4  1536536  1630347  1639131
5 10352843 12251209 14326203
6  6121610  7021078  8390505</code></pre>
</div>
</div>
<p>The first step towards getting our nice intermediate data format is to first convert from the wide to the long format. The function <code>pivot_longer()</code> will ‘gather’ the observation variables into a single variable. This is sometimes called “melting” your data, because it melts the table from wide to long. Those data will be melted into two variables: one for the variable names, and the other for the variable values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>gap_long <span class="ot">&lt;-</span> gap_wide <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(gdpPercap_1952<span class="sc">:</span>pop_2007)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  continent country name           value
  &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 Africa    Algeria gdpPercap_1952 2449.
2 Africa    Algeria gdpPercap_1957 3014.
3 Africa    Algeria gdpPercap_1962 2551.
4 Africa    Algeria gdpPercap_1967 3247.
5 Africa    Algeria gdpPercap_1972 4183.
6 Africa    Algeria gdpPercap_1977 4910.</code></pre>
</div>
</div>
<p>Formerly one used the function <code>gather</code> to do this, but many people found it not to be intuitive to use.</p>
</section>
<section id="tidyrselect" class="level1">
<h1><code>tidyr::select</code></h1>
<p>If there are a lot of columns or they’re named in a consistent pattern, we might not want to select them using the column numbers. It’d be easier to use some information contained in the names themselves. We can select variables using:</p>
<ul>
<li>variable indices</li>
<li>variable names (without quotes)</li>
<li><code>x:z</code> to select all variables between x and z</li>
<li><code>-y</code> to <em>exclude</em> y</li>
<li><code>starts_with(x, ignore.case = TRUE)</code>: all names that starts with <code>x</code></li>
<li><code>ends_with(x, ignore.case = TRUE)</code>: all names that ends with <code>x</code></li>
<li><code>contains(x, ignore.case = TRUE)</code>: all names that contain <code>x</code></li>
</ul>
<p>See the <code>select()</code> function in <code>dplyr</code> for more options.</p>
<p>For instance, here we do the same gather operation with (1) the <code>starts_with</code> function, and (2) the <code>-</code> operator:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># with the starts_with() function</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>gap_long <span class="ot">&lt;-</span> gap_wide <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'pop'</span>), <span class="fu">starts_with</span>(<span class="st">'lifeExp'</span>), <span class="fu">starts_with</span>(<span class="st">'gdpPercap'</span>)))</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  continent country name        value
  &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;
1 Africa    Algeria pop_1952  9279525
2 Africa    Algeria pop_1957 10270856
3 Africa    Algeria pop_1962 11000948
4 Africa    Algeria pop_1967 12760499
5 Africa    Algeria pop_1972 14760787
6 Africa    Algeria pop_1977 17152804</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># with the - operator</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>gap_long <span class="ot">&lt;-</span> gap_wide <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="sc">-</span>continent, <span class="sc">-</span>country))</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  continent country name           value
  &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 Africa    Algeria gdpPercap_1952 2449.
2 Africa    Algeria gdpPercap_1957 3014.
3 Africa    Algeria gdpPercap_1962 2551.
4 Africa    Algeria gdpPercap_1967 3247.
5 Africa    Algeria gdpPercap_1972 4183.
6 Africa    Algeria gdpPercap_1977 4910.</code></pre>
</div>
</div>
<p>However you choose to do it, notice that the output collapses all of the measure variables into two columns: one containing new ID variable, the other containing the observation value for that row.</p>
</section>
<section id="tidyrseparate" class="level1">
<h1><code>tidyr::separate</code></h1>
<p>You’ll notice that in our long dataset, <code>name</code> actually contains 2 pieces of information, the observation type (<code>pop</code>, <code>lifeExp</code>, or <code>gdpPercap</code>) and the <code>year</code>.</p>
<p>We can use the <code>separate()</code> function to split the character strings into multiple variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>gap_long_sep <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">'obs_type'</span>,<span class="st">'year'</span>), <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(year))</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_long_sep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  continent country obs_type   year value
  &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt;
1 Africa    Algeria gdpPercap  1952 2449.
2 Africa    Algeria gdpPercap  1957 3014.
3 Africa    Algeria gdpPercap  1962 2551.
4 Africa    Algeria gdpPercap  1967 3247.
5 Africa    Algeria gdpPercap  1972 4183.
6 Africa    Algeria gdpPercap  1977 4910.</code></pre>
</div>
</div>
<p>If you didn’t use <code>tidyr</code> to do this, you’d have to use the <code>strsplit</code> function and use multiple lines of code to replace the column in <code>gap_long</code> with two new columns. This solution is much cleaner.</p>
</section>
<section id="tidyrpivot_wider" class="level1">
<h1><code>tidyr::pivot_wider</code></h1>
<p>The opposite of <code>pivot_longer()</code> is <code>pivot_wider()</code>. It spreads our observation variables back out to make a wider table. We can use this function to spread our <code>gap_long()</code> to the original “medium” format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>gap_medium <span class="ot">&lt;-</span> gap_long_sep <span class="sc">%&gt;%</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> obs_type, <span class="at">values_from =</span> value)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_medium)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  continent country  year gdpPercap lifeExp      pop
  &lt;chr&gt;     &lt;chr&gt;   &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 Africa    Algeria  1952     2449.    43.1  9279525
2 Africa    Algeria  1957     3014.    45.7 10270856
3 Africa    Algeria  1962     2551.    48.3 11000948
4 Africa    Algeria  1967     3247.    51.4 12760499
5 Africa    Algeria  1972     4183.    54.5 14760787
6 Africa    Algeria  1977     4910.    58.0 17152804</code></pre>
</div>
</div>
<p>Formerly one used the function <code>spread</code> to do this, but many people found it not to be intuitive to use.</p>
<p>All we need is some quick fixes to make this dataset identical to the original <code>gapminder</code> dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gapminder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  country     continent  year lifeExp      pop gdpPercap
  &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
1 Afghanistan Asia       1952    28.8  8425333      779.
2 Afghanistan Asia       1957    30.3  9240934      821.
3 Afghanistan Asia       1962    32.0 10267083      853.
4 Afghanistan Asia       1967    34.0 11537966      836.
5 Afghanistan Asia       1972    36.1 13079460      740.
6 Afghanistan Asia       1977    38.4 14880372      786.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rearrange columns</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>gap_medium <span class="ot">&lt;-</span> gap_medium[,<span class="fu">names</span>(gapminder)]</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_medium)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  country continent  year lifeExp      pop gdpPercap
  &lt;chr&gt;   &lt;chr&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Algeria Africa     1952    43.1  9279525     2449.
2 Algeria Africa     1957    45.7 10270856     3014.
3 Algeria Africa     1962    48.3 11000948     2551.
4 Algeria Africa     1967    51.4 12760499     3247.
5 Algeria Africa     1972    54.5 14760787     4183.
6 Algeria Africa     1977    58.0 17152804     4910.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange by country, continent, and year</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>gap_medium <span class="ot">&lt;-</span> gap_medium <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(country, continent, year)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_medium)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  country     continent  year lifeExp      pop gdpPercap
  &lt;chr&gt;       &lt;chr&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 Afghanistan Asia       1952    28.8  8425333      779.
2 Afghanistan Asia       1957    30.3  9240934      821.
3 Afghanistan Asia       1962    32.0 10267083      853.
4 Afghanistan Asia       1967    34.0 11537966      836.
5 Afghanistan Asia       1972    36.1 13079460      740.
6 Afghanistan Asia       1977    38.4 14880372      786.</code></pre>
</div>
</div>
</section>
<section id="extra-resources-optional" class="level1">
<h1>Extra Resources (optional)</h1>
<p><code>dplyr</code> and <code>tidyr</code> have many more functions to help you wrangle and manipulate your data. See the <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data Wrangling Cheat Sheet</a> for more.</p>
<p>Here are <a href="https://www.r-bloggers.com/2022/07/eight-r-tidyverse-tips-for-everyday-data-engineering/?utm_source=phpList&amp;utm_medium=email&amp;utm_campaign=R-bloggers-daily&amp;utm_content=HTML">some additional functions/verbs</a> for use with dplyr:</p>
<p>There are some other useful packages in the <a href="http://www.tidyverse.org">tidyverse</a>:</p>
<ul>
<li><code>ggplot2</code> for plotting (We’ll cover this in module 7)</li>
<li><code>readr</code> and <code>haven</code> for reading in data</li>
<li><code>purrr</code> for working with lists and operations similar to the <code>lapply</code> family introduced in Module 4.</li>
<li><code>stringr</code>, <code>lubridate</code>, <code>forcats</code> for manipulating strings, dates, and factors, respectively</li>
<li>many many more! Take a peak at the <a href="https://github.com/tidyverse">tidyverse github page</a>…</li>
</ul>
<p><strong>Pro Tip:</strong> To install and load the core tidyverse packages (includes <code>tidyr</code>, <code>dplyr</code>, and <code>ggplot2</code>, among others), try:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NOT run</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="breakout" class="level1">
<h1>Breakout</h1>
<section id="dplyr" class="level3">
<h3 class="anchored" data-anchor-id="dplyr"><code>dplyr</code></h3>
<ol type="1">
<li><p>Use <code>dplyr</code> to create a data frame containing the median <code>lifeExp</code> for each continent</p></li>
<li><p>Use <code>dplyr</code> to add a column to the gapminder dataset that contains the total population of the continent of each observation in a given year. For example, if the first observation is Afghanistan in 1952, the new column would contain the population of Asia in 1952.</p></li>
<li><p>Use <code>dplyr</code> to add a column called <code>gdpPercap_diff</code> that contains the difference between the observation’s <code>gdpPercap</code> and the mean <code>gdpPercap</code> of the continent in that year. Arrange the data frame by the column you just created, in descending order (so that the relatively richest country/years are listed first)</p></li>
</ol>
</section>
<section id="tidyr-1" class="level3">
<h3 class="anchored" data-anchor-id="tidyr-1"><code>tidyr</code></h3>
<ol start="4" type="1">
<li>Subset the results from question #3 to select only the <code>country</code>, <code>year</code>, and <code>gdpPercap_diff</code> columns. Use tidyr put it in wide format so that countries are rows and years are columns.</li>
</ol>
<p>Hint: you’ll probably see a message about a missing grouping variable. If you don’t want continent included, you can pass the output of problem 3 through <code>ungroup()</code> to get rid of the continent information.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/paciorek\.github\.io\/r-voleon-2025");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>